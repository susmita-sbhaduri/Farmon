<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                template="./../../WEB-INF/template.xhtml"                
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="jakarta.faces.core"
                xmlns:h="jakarta.faces.html">

    <ui:define name="content">
        <h4>Details of application of the selected resource.</h4>
        <p:growl id="growl" showDetail="true" life="5000" sticky="false" />

        <div class="card">
            <h:form id="openschedule" style="text-align: center">
                <input type="hidden" id="scheduleRangeStart" name="scheduleRangeStart" />
                <input type="hidden" id="scheduleRangeEnd" name="scheduleRangeEnd" />

                <p:remoteCommand name="rcOnViewChange"
                                 action="#{openSchedule.onScheduleDateRangeChange}"
                                 process="@this"
                                 update="schedule"
                                 />
                <p:schedule id="schedule" value="#{openSchedule.eventModel}" widgetVar="myschedule">
                    <p:ajax event="viewChange"
                            oncomplete="handleScheduleViewChange();"/>
<!--                    <p:ajax event="viewChange" listener="#{openSchedule.onViewChange}" update="schedule" />-->
                    <p:ajax event="dateSelect" listener="#{openSchedule.onDateSelect}" 
                            update="eventDetails"
                            oncomplete="PF('eventDialog').show();" />
                </p:schedule>
                <p:dialog id="eventDetails"
                          widgetVar="eventDialog" 
                          modal="true" 
                          resizable="false">
                    <ui:repeat value="#{beanProg.eventsForSelectedDate}" var="event">
                        <h:outputText value="Title: #{event.title}" /><br/>
                        <h:outputText value="Start: #{event.startDate}" /><br/>
                        <h:outputText value="End: #{event.endDate}" /><br/>
                        <h:outputText value="Description: #{event.description}" /><br/>
                        <hr/>
                    </ui:repeat>
                </p:dialog>
                <!-- Put this in your .xhtml file, before or after your <p:schedule> -->
                <script type="text/javascript">
                    function handleScheduleViewChange() {
                        var sched = PF('myschedule').getCalendar();
                        var start = sched.view.activeStart;
                        var end = sched.view.activeEnd;

                        var startStr = start.toISOString().slice(0, 10);
                        var endStr = end.toISOString().slice(0, 10);

                        document.getElementById('scheduleRangeStart').value = startStr;
                        document.getElementById('scheduleRangeEnd').value = endStr;

                        rcOnViewChange([{name: 'rangeStart', value: startStr}, {name: 'rangeEnd', value: endStr}]);
                    }
                </script>
                
            </h:form>
        </div>
    </ui:define>

</ui:composition>

